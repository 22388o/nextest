<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>cargo-nextest</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A next-generation test runner for Rust.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">cargo-nextest</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="book/installation.html"><strong aria-hidden="true">1.</strong> Installation and usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/running.html"><strong aria-hidden="true">1.1.</strong> Running tests</a></li><li class="chapter-item expanded "><a href="book/listing.html"><strong aria-hidden="true">1.2.</strong> Listing tests</a></li><li class="chapter-item expanded "><a href="book/retries.html"><strong aria-hidden="true">1.3.</strong> Retries and flaky tests</a></li><li class="chapter-item expanded "><a href="book/partitioning.html"><strong aria-hidden="true">1.4.</strong> Partitioning test runs in CI</a></li><li class="chapter-item expanded "><a href="book/other-options.html"><strong aria-hidden="true">1.5.</strong> Other options</a></li><li class="chapter-item expanded "><a href="book/env-vars.html"><strong aria-hidden="true">1.6.</strong> Environment variables</a></li><li class="chapter-item expanded "><a href="book/stability.html"><strong aria-hidden="true">1.7.</strong> Stability policy</a></li></ol></li><li class="chapter-item expanded "><a href="book/machine-readable.html"><strong aria-hidden="true">2.</strong> Machine-readable output</a></li><li class="chapter-item expanded "><a href="book/configuration.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="book/junit.html"><strong aria-hidden="true">4.</strong> JUnit support</a></li><li class="chapter-item expanded "><a href="book/how-it-works.html"><strong aria-hidden="true">5.</strong> How nextest works</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/custom-test-harnesses.html"><strong aria-hidden="true">5.1.</strong> Custom test harnesses</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">cargo-nextest</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nextest-rs/nextest/tree/main/site" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cargo-nextest"><a class="header" href="#cargo-nextest">cargo-nextest</a></h1>
<p>Welcome to the home page for cargo-nextest, a next-generation test runner for Rust projects.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>Nextest is <strong>up to 60% faster</strong> than cargo test! Nextest uses a <a href="book/how-it-works.html">state-of-the-art execution model</a> for faster, more reliable test runs.</li>
<li><strong>Detect flaky tests.</strong> Nextest can <a href="book/retries.html">automatically retry</a> failing tests for you, and if they pass later nextest will mark them as flaky.</li>
<li><strong>Partitioning test runs across several machines.</strong> If your tests take too long on one machine in CI, nextest can automatically shard them for you across several jobs.</li>
<li><strong>Cross-platform.</strong> nextest works on Unix, Mac and Windows, so you get the benefits of faster test runs no matter what platform you use.</li>
<li>... and more coming soon!</li>
</ul>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick start</a></h2>
<p>Install cargo-nextest from crates.io (requires <strong>Rust 1.54</strong> or later):</p>
<pre><code>cargo install cargo-nextest
</code></pre>
<p>Run all tests in a workspace:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more detailed installation instructions, see <a href="book/installation.html">Installation and usage</a>.</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The source code for nextest and this site are hosted on GitHub, at
<a href="https://github.com/nextest-rs/nextest">https://github.com/nextest-rs/nextest</a>. Contributions are
welcome! Please see the <a href="https://github.com/nextest-rs/nextest/blob/main/CONTRIBUTING.md">CONTRIBUTING
file</a> for how to help out.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>The source code for nextest is licensed under the
<a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-MIT">MIT</a> and <a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-APACHE">Apache
2.0</a> licenses.</p>
<p>This document is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. This means that you are welcome to share, adapt or
modify this material as long as you give appropriate credit.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-and-usage"><a class="header" href="#installation-and-usage">Installation and usage</a></h1>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>cargo-nextest works on Linux and other Unix-like OSes, macOS, and Windows.</p>
<h3 id="installing-from-cratesio"><a class="header" href="#installing-from-cratesio">Installing from crates.io</a></h3>
<p>Run the following command:</p>
<pre><code>cargo install cargo-nextest
</code></pre>
<p><code>cargo nextest</code> must be compiled and installed with <strong>Rust 1.54</strong> or later, but it can build and run
tests against any version of Rust.</p>
<blockquote>
<p>TODO: Add pre-built binaries.</p>
</blockquote>
<h3 id="using-a-cached-install-in-ci"><a class="header" href="#using-a-cached-install-in-ci">Using a cached install in CI</a></h3>
<p>Most CI users of nextest will benefit from using cached binaries. If your CI is based on GitHub
Actions, you may use the
<a href="https://github.com/marketplace/actions/cargo-install">baptiste0928/cargo-install</a> action to cache
the cargo-nextest binary.</p>
<pre><code class="language-yml">jobs:
  ci:
    # ...
    steps:
      - uses: actions/checkout@v2
      # install a Rust toolchain here
      - name: Install cargo-nextest
        uses: baptiste0928/cargo-install@v1
        with:
          crate: cargo-nextest
          version: 0.9
</code></pre>
<p>Also consider using the <a href="https://github.com/marketplace/actions/rust-cache">Swatinem/rust-cache</a>
action to make your builds faster.</p>
<h3 id="installing-from-github"><a class="header" href="#installing-from-github">Installing from GitHub</a></h3>
<p>Install the latest, in-development version of cargo-nextest from the GitHub repository:</p>
<pre><code>cargo install --git https://github.com/nextest-rs/nextest --bin cargo-nextest
</code></pre>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic usage</a></h2>
<p>To build and run all tests in a workspace, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more information about running tests, see <a href="book/running.html">Running tests</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-tests"><a class="header" href="#running-tests">Running tests</a></h1>
<p>To build and run all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>This will produce output that looks like:</p>
<img src="https://user-images.githubusercontent.com/180618/153310973-a6d8d37f-5978-4231-ae5a-ee38ed008def.png"/>
<p>In the output above:</p>
<ul>
<li>
<p>Tests are marked <strong><code>PASS</code></strong> or <strong><code>FAIL</code></strong>, and the amount of wall-clock time each test takes is listed within square brackets. In the example above, <strong><code>test_list_tests</code></strong> passed and took 0.603 seconds to execute.</p>
</li>
<li>
<p>The part of the test in purple is the <em>test binary</em>. A test binary is either:</p>
<ul>
<li>a <em>unit test binary</em> built from tests inline within <code>lib.rs</code>. These test binaries are shown by nextest as just the crate name, without a <code>::</code> separator inside them.</li>
<li>an <em>integration test binary</em> built from tests in the <code>[[test]]</code> section of <code>Cargo.toml</code> (typically tests in the <code>tests</code> directory.) These tests are shown by nextest in the format <code>crate-name::bin-name</code>.</li>
</ul>
<p>For more about unit and integration tests, see <a href="https://doc.rust-lang.org/cargo/commands/cargo-test.html">the documentation for <code>cargo test</code></a>.</p>
</li>
<li>
<p>The part after the test binary is the <em>test name</em>, including the module the test is in. The final part of the test name is highlighted in bold blue text.</p>
</li>
</ul>
<p><code>cargo nextest run</code> supports all the options that <code>cargo test</code> does. For example, to only execute tests for a package called <code>my-package</code>:</p>
<pre><code>cargo nextest run -p my-package
</code></pre>
<p>For a full list of options accepted by <code>cargo nextest run</code>, see <code>cargo nextest run --help</code>.</p>
<h3 id="filtering-tests"><a class="header" href="#filtering-tests">Filtering tests</a></h3>
<p>To only run tests that match certain names:</p>
<pre><code>cargo nextest run &lt;test-name1&gt; &lt;test-name2&gt;...
</code></pre>
<p>This is different from <code>cargo test</code>, where you have to specify a <code>--</code>, for example: <code>cargo test -- &lt;test-name1&gt; &lt;test-name2&gt;...</code>.</p>
<h3 id="displaying-live-test-output"><a class="header" href="#displaying-live-test-output">Displaying live test output</a></h3>
<p>By default, <code>cargo nextest run</code> will capture test output and only display it on failure. If you do <em>not</em> want to capture test output:</p>
<pre><code>cargo nextest run --no-capture
</code></pre>
<p>In this mode, cargo-nextest will run tests <em>serially</em> so that output from different tests isn't interspersed. This is different from <code>cargo test -- --nocapture</code>, which will run tests in parallel.</p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-tests"><a class="header" href="#listing-tests">Listing tests</a></h1>
<p>To build and list all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest list
</code></pre>
<p>This will produce output that looks something like:</p>
<img src="https://user-images.githubusercontent.com/180618/153310585-48d1aacd-a3a0-4fde-97e8-6b79f2dcb85f.png" width="100%"/>
<p>For each test binary, <strong>bin:</strong> shows the name of the test binary that is run, and <strong>cwd:</strong> shows the name of the working directory the binary will be executed within. Test names are listed below.</p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust.</p>
</div>
<p><code>cargo nextest list</code> takes most of the same options that <code>cargo nextest run</code> takes. For a full list of options accepted, see <code>cargo nextest list --help</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retries-and-flaky-tests"><a class="header" href="#retries-and-flaky-tests">Retries and flaky tests</a></h1>
<p>Sometimes, tests fail nondeterministically, which can be quite annoying to developers locally and in CI. cargo-nextest supports <em>retrying</em> failed tests with the <code>--retries</code> option. If a test succeeds during a retry, the test is marked <em>flaky</em>. Here's an example:</p>
<img src="https://user-images.githubusercontent.com/180618/153311213-0fde9a74-f8ee-4701-a754-6866b80c476f.png"/>
<p><code>--retries 2</code> means that the test is retried twice, for a total of three attempts. In this case, the test fails on the first try but succeeds on the second try. The <code>TRY 2 PASS</code> text means that the test passed on the second try.</p>
<p>Flaky tests are treated as ultimately successful. If there are no other tests that failed, the exit code for the test run is 0.</p>
<p>Retries can also be <a href="book/configuration.html">configured in <code>.config/nextest.toml</code></a>. The command-line <code>--retries</code> option overrides the configured value.</p>
<p>Flaky test detection is integrated with nextest's JUnit support. For more information, see <a href="book/junit.html">JUnit support</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partitioning-test-runs-in-ci"><a class="header" href="#partitioning-test-runs-in-ci">Partitioning test runs in CI</a></h1>
<p>For CI scenarios where test runs take too long on a single machine, nextest supports automatically <em>partitioning</em> or <em>sharding</em> tests into buckets.</p>
<p>cargo-nextest supports both <em>hash-based</em> and <em>count-based</em> partitioning. Here's an example of count-based partitioning, running tests in bucket 1 of 2.</p>
<img src="https://user-images.githubusercontent.com/180618/153311562-f7a1b194-a968-4d08-b4c9-67afae19da72.png"/>
<p>Tests not in the current bucket are marked skipped.</p>
<p>Count-based partitioning is done <em>per test binary</em>. This means that the tests in one binary <em>do not</em> influence counting for other binaries.</p>
<p>Hash-based partitioning is similar, except buckets are specified in the format <code>hash:m/n</code>, where <code>m</code> is the current bucket and <code>n</code> is the number of buckets. The hash is completely deterministic, and is based on a combination of the binary and test names. For sufficiently large test runs, hash-based partitioning produces roughly the same number of tests per bucket.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-options"><a class="header" href="#other-options">Other options</a></h1>
<p>Some other options accepted by <code>cargo nextest run</code>:</p>
<ul>
<li><code>--no-fail-fast</code>: do not exit the test run on the first failure. Most useful for CI scenarios.</li>
<li><code>-j, --test-threads</code>: number of tests to run simultaneously. Note that this is separate from the number of build jobs to run simultaneously, which is specified by <code>--build-jobs</code>.</li>
<li><code>--run-ignored ignored-only</code> runs ignored tests, while <code>--run-ignored all</code> runs both ignored and non-ignored tests.</li>
<li><code>--failure-output</code> and <code>--success-output</code> control when standard output and standard error are displayed for failing and passing tests, respectively. The possible values are:
<ul>
<li><code>immediate</code>: display output as soon as the test fails. Default for <code>--failure-output</code>.</li>
<li><code>final</code>: display output at the end of the test run.</li>
<li><code>immediate-final</code>: display output as soon as the test fails, and at the end of the run. This is most useful for CI runs.</li>
<li><code>never</code>: never display output. Default for <code>--success-output</code>.</li>
</ul>
</li>
<li><code>--status-level</code>: which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display. There are 7 status levels: <code>none, fail, retry, slow, pass, skip, all</code>. Each status level causes all earlier status levels to be displayed as well. (For example, setting <code>status-level</code> to <code>skip</code> will show failing, retried, slow and passing tests along with skipped tests.) The default is <code>pass</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h1>
<p>This section contains information about the environment variables nextest reads and sets.</p>
<h2 id="environment-variables-nextest-reads"><a class="header" href="#environment-variables-nextest-reads">Environment variables nextest reads</a></h2>
<p>Currently, cargo-nextest does not read its configuration as environment variables. <a href="https://github.com/nextest-rs/nextest/issues/14">This will be supported in the future</a>.</p>
<h3 id="cargo-related-environment-variables-nextest-reads"><a class="header" href="#cargo-related-environment-variables-nextest-reads">Cargo-related environment variables nextest reads</a></h3>
<p>cargo-nextest delegates to Cargo for the build, which recognizes a number of environment variables. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads">Environment variables Cargo reads</a> for a full list.</p>
<h2 id="environment-variables-nextest-sets"><a class="header" href="#environment-variables-nextest-sets">Environment variables nextest sets</a></h2>
<p>cargo-nextest exposes these environment variables to your tests <em>at runtime only</em>. They are not set at build time because cargo-nextest may reuse builds done outside of the nextest environment.</p>
<ul>
<li><code>NEXTEST</code> — always set to <code>&quot;1&quot;</code>.</li>
</ul>
<h3 id="cargo-related-environment-variables-nextest-sets"><a class="header" href="#cargo-related-environment-variables-nextest-sets">Cargo-related environment variables nextest sets</a></h3>
<p>cargo-nextest delegates to Cargo for the build, which controls the environment variables that are set. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates">Environment variables Cargo sets for crates</a> for a full list.</p>
<p>cargo-nextest also sets these environment variables at runtime, matching the behavior of cargo test:</p>
<ul>
<li><code>CARGO</code> — Path to the <code>cargo</code> binary performing the build.</li>
<li><code>CARGO_MANIFEST_DIR</code> — The directory containing the manifest of your package.</li>
<li><code>CARGO_PKG_VERSION</code> — The full version of your package.</li>
<li><code>CARGO_PKG_VERSION_MAJOR</code> — The major version of your package.</li>
<li><code>CARGO_PKG_VERSION_MINOR</code> — The minor version of your package.</li>
<li><code>CARGO_PKG_VERSION_PATCH</code> — The patch version of your package.</li>
<li><code>CARGO_PKG_VERSION_PRE</code> — The pre-release version of your package.</li>
<li><code>CARGO_PKG_AUTHORS</code> — Colon separated list of authors from the manifest of your package.</li>
<li><code>CARGO_PKG_NAME</code> — The name of your package.</li>
<li><code>CARGO_PKG_DESCRIPTION</code> — The description from the manifest of your package.</li>
<li><code>CARGO_PKG_HOMEPAGE</code> — The home page from the manifest of your package.</li>
<li><code>CARGO_PKG_REPOSITORY</code> — The repository from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE</code> — The license from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE_FILE</code> — The license file from the manifest of your package.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stability-policy"><a class="header" href="#stability-policy">Stability policy</a></h1>
<p>This section contains information on how cargo-nextest will evolve in a backwards-compatible way over time.</p>
<h2 id="the-cargo-nextest-binary"><a class="header" href="#the-cargo-nextest-binary">The cargo-nextest binary</a></h2>
<p>The cargo-nextest binary follows <a href="https://semver.org/">semantic versioning</a>, where the <a href="https://semver.org/#spec-item-1">public API</a> is declared to consist of exactly the following:</p>
<ol>
<li>command-line arguments</li>
<li><a href="book/machine-readable.html">machine-readable output</a></li>
<li>the <a href="book/configuration.html">configuration file format</a></li>
</ol>
<p>Within a version series, the public API will be append-only. New options or keys may be added, but existing keys will continue to be as they were.</p>
<p>The public API does <em>not</em> include human-readable output generated by nextest, or in general anything printed to stderr.</p>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<p>The libraries used by cargo-nextest, <a href="https://crates.io/crates/nextest-metadata">nextest-metadata</a> and <a href="https://crates.io/crates/nextest-runner">nextest-runner</a>, follow the standard Rust library versioning policy.</p>
<h2 id="minimum-supported-rust-version-msrv"><a class="header" href="#minimum-supported-rust-version-msrv">Minimum supported Rust version (MSRV)</a></h2>
<p>The MSRV of cargo-nextest or dependent crates may be changed in a patch release. At least the last 3 versions of Rust will be supported at any time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machine-readable-output"><a class="header" href="#machine-readable-output">Machine-readable output</a></h1>
<p>cargo-nextest can be configured to produce machine-readable JSON output, readable by other programs. The <a href="https://crates.io/crates/nextest-metadata">nextest-metadata crate</a> provides a Rust interface to deserialize the output to. (The same crate is used by nextest to generate the output.)</p>
<h2 id="listing-tests-1"><a class="header" href="#listing-tests-1">Listing tests</a></h2>
<p>To produce a list of tests in the JSON output format <code>cargo nextest list --message-format json</code> (or <code>json-pretty</code> for nicely formatted output). Here's some example output for the <a href="https://github.com/tokio-rs/tokio">tokio repository</a>:</p>
<pre><code class="language-json">% cargo nextest list -p tokio-util --features full --lib --format json-pretty
{
  &quot;test-count&quot;: 4,
  &quot;rust-suites&quot;: {
    &quot;tokio-util&quot;: {
      &quot;package-name&quot;: &quot;tokio-util&quot;,
      &quot;binary-name&quot;: &quot;tokio-util&quot;,
      &quot;package-id&quot;: &quot;tokio-util 0.7.0 (path+file:///home/me/dev/tokio/tokio-util)&quot;,
      &quot;binary-path&quot;: &quot;/home/me/dev/tokio/target/debug/deps/tokio_util-def0ee51cb418fe8&quot;,
      &quot;cwd&quot;: &quot;/home/rain/dev/tokio/tokio-util&quot;,
      &quot;testcases&quot;: {
        &quot;either::tests::either_is_async_read&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;either::tests::either_is_stream&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;time::wheel::level::test::test_slot_for&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;time::wheel::test::test_level_for&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        }
      }
    }
  }
}
</code></pre>
<p>The value of <code>&quot;package-id&quot;</code> can be matched up to the package IDs produced by running <code>cargo metadata</code>.</p>
<h2 id="running-tests-1"><a class="header" href="#running-tests-1">Running tests</a></h2>
<p>This is <a href="https://github.com/nextest-rs/nextest/issues/20">currently not implemented</a>, but will be implemented in the near future.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>cargo-nextest supports repository-specific configuration at the location <code>.config/nextest.toml</code> from the Cargo workspace root. The location of the configuration file can be overridden with the <code>--config-file</code> option.</p>
<p>The default configuration shipped with cargo-nextest is:</p>
<pre><code class="language-toml"># This is the default config used by nextest. It is embedded in the binary at
# build time. It may be used as a template for .config/nextest.toml.

[store]
# The directory under the workspace root at which nextest-related files are
# written. Profile-specific storage is currently written to dir/&lt;profile-name&gt;.
dir = &quot;target/nextest&quot;

# This section defines the default nextest profile. Custom profiles are layered
# on top of the default profile.
[profile.default]
# &quot;retries&quot; defines the number of times a test should be retried. If set to a
# non-zero value, tests that succeed on a subsequent attempt will be marked as
# non-flaky. Can be overridden through the `--retries` option.
retries = 0

# Show these test statuses in the output.
#
# The possible values this can take are:
# * none: no output
# * fail: show failed (including exec-failed) tests
# * retry: show flaky and retried tests
# * slow: show slow tests
# * pass: show passed tests
# * skip: show skipped tests (most useful for CI)
# * all: all of the above
#
# Each value includes all the values above it; for example, &quot;slow&quot; includes
# failed and retried tests.
#
# Can be overridden through the `--status-level` flag.
status-level = &quot;pass&quot;

# &quot;failure-output&quot; defines when test failures are output to standard output.
# Accepted values are
# * &quot;immediate&quot;: output failures as soon as they happen
# * &quot;final&quot;: output failures at the end of the test run
# * &quot;immediate-final&quot;: output failures as soon as they happen and at the end of
#   the test run
# * &quot;never&quot;: don't output failures at all
#
# For large test suites and CI it is generally useful to use &quot;immediate-final&quot;.
#
# Can be overridden through the `--failure-output` option.
failure-output = &quot;immediate&quot;

# &quot;success-output&quot; controls output on success. This should generally be set to
# &quot;never&quot;.
success-output = &quot;never&quot;

# Cancel the test run on the first failure. For CI runs, consider setting this
# to false.
fail-fast = true

# Treat a test that takes longer than this as slow, and print a message.
slow-timeout = &quot;60s&quot;

[profile.default.junit]
# Output a JUnit report into the given file inside 'store.dir/&lt;profile-name&gt;'.
# If unspecified, JUnit is not written out.

# path = &quot;junit.xml&quot;

# The name of the top-level &quot;report&quot; element in JUnit report. If aggregating
# reports across different test runs, it may be useful to provide separate names
# for each report.
report-name = &quot;nextest-run&quot;
</code></pre>
<h2 id="profiles"><a class="header" href="#profiles">Profiles</a></h2>
<p>With cargo-nextest, local and CI runs often need to use different settings. For example, CI test runs should not be cancelled as soon as the first test failure is seen.</p>
<p>cargo-nextest supports multiple <em>profiles</em>, where each profile is a set of options for cargo-nextest. Profiles are selected on the command line with the <code>-P</code> or <code>--profile</code> option. Most individual configuration settings can also be overridden at the command line.</p>
<p>Here is a recommended profile for CI runs:</p>
<pre><code class="language-toml">[profile.ci]
# Detect flaky tests in CI by retrying tests twice.
retries = 2
# Print out output for failing tests as soon as they fail, and also at the end
# of the run (for easy scrollability).
failure-output = &quot;immediate-final&quot;
# Do not cancel the test run on the first failure.
fail-fast = false
</code></pre>
<p>After checking the profile into <code>.config/nextest.toml</code>, use <code>cargo nextest --profile ci</code> in your CI runs.</p>
<h2 id="hierarchical-configuration"><a class="header" href="#hierarchical-configuration">Hierarchical configuration</a></h2>
<p>Configuration is resolved in the following order:</p>
<ol>
<li>Command-line arguments. For example, if <code>--retries=3</code> is specified on the command line, failing tests are retried up to 3 times.</li>
<li>Profile-specific configuration. For example, if <code>--profile ci</code> is selected in the example above, failing tests are retried up to 2 times.</li>
<li>Repository-specific configuration for the <code>default</code> profile. For example, if the repository-specific configuration looks like:
<pre><code class="language-toml">[profile.default]
retries = 5
</code></pre>
then failing tests are retried up to 5 times.</li>
<li>The default configuration listed above, which is that tests are never retried.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="junit-support"><a class="header" href="#junit-support">JUnit support</a></h1>
<p>cargo-nextest can produce output in the <a href="https://llg.cubic.org/docs/junit/">JUnit/XUnit XML format</a>. This format is widely understood by test analysis tools and libraries.</p>
<p>To enable JUnit support, add this to your configuration:</p>
<pre><code class="language-toml">[profile.ci.junit]  # this can be some other profile, too
path = &quot;junit.xml&quot;
</code></pre>
<p>If <code>--profile ci</code> is selected on the command line, a JUnit report will be written out to <code>target/nextest/ci/junit.xml</code> within the workspace root.</p>
<p>Some notes about the JUnit support:</p>
<ul>
<li>There are several slightly different formats all called &quot;JUnit&quot; or &quot;XUnit&quot;. cargo-nextest adheres to the <a href="https://llg.cubic.org/docs/junit/">Jenkins XML format</a>.</li>
<li>Every test binary forms a single <code>&lt;testsuite&gt;</code>. Every test forms a single <code>&lt;testcase&gt;</code>.</li>
<li>Standard output and standard error are included for failed and retried tests. (However, <a href="https://en.wikipedia.org/wiki/Valid_characters_in_XML">invalid XML characters</a> are stripped out.)</li>
</ul>
<p>Here's an example JUnit file generated by <code>cargo-nextest</code>.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;testsuites name=&quot;nextest-run&quot; tests=&quot;3&quot; failures=&quot;1&quot; errors=&quot;0&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.003&quot;&gt;
    &lt;testsuite name=&quot;nextest-tests::basic&quot; tests=&quot;3&quot; disabled=&quot;0&quot; errors=&quot;0&quot; failures=&quot;1&quot;&gt;
        &lt;testcase name=&quot;test_cwd&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase name=&quot;test_flaky_mod_2&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.394+00:00&quot; time=&quot;0.001&quot;&gt;
            &lt;flakyFailure timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_flaky_mod_2 ... FAILED

failures:

failures:
    test_flaky_mod_2

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_flaky_mod_2&amp;apos; panicked at &amp;apos;Failed because attempt 1 % 2 != 0&amp;apos;, tests/basic.rs:33:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/flakyFailure&gt;
        &lt;/testcase&gt;
        &lt;testcase name=&quot;test_failure_assert&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot;&gt;
            &lt;failure type=&quot;test failure&quot;/&gt;
            &lt;rerunFailure timestamp=&quot;2022-02-10T20:09:34.395+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;rerunFailure timestamp=&quot;2022-02-10T20:09:34.396+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
            &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
        &lt;/testcase&gt;
    &lt;/testsuite&gt;
&lt;/testsuites&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-nextest-works"><a class="header" href="#how-nextest-works">How nextest works</a></h1>
<p>To understand how nextest works, it is useful to first look at the execution model used by cargo test.</p>
<h2 id="the-cargo-test-execution-model"><a class="header" href="#the-cargo-test-execution-model">The cargo test execution model</a></h2>
<p>By default, cargo test uses this execution model:</p>
<img src="https://user-images.githubusercontent.com/180618/153318042-350a4fd3-4d4a-4c64-bf3d-f0763a0bd9ee.png"/>
<p>In this model, each test binary is run serially, and binaries are responsible for running individual tests in parallel.</p>
<p>This model provides the greatest flexibility because <em>the only interface between cargo test and the binary is the exit code</em>. For cargo test, a binary exiting with exit code 0 means that all tests within it passed, while a non-zero exit code means that some tests within it failed.</p>
<p>However, this model has several problems:</p>
<ol>
<li><strong>There's no structured way to get individual test pass/fail status</strong>, or the time taken by each test.</li>
<li><strong>The first binary failure means that no further tests are run</strong>, unless <code>--no-fail-fast</code> is passed in. If that argument is passed in in CI scenarios, then failing test output is not printed at the end, making it hard to figure out which tests failed.</li>
<li><strong>Performance can be affected by &quot;long pole&quot; tests.</strong> For example, if a binary has 20 tests and 19 of them take less than 5s, while one of them takes 60 seconds, then the test binary will take 60s to execute. <code>cargo test</code> has no way to start running other test binaries in those last 55 seconds. </li>
</ol>
<h2 id="the-nextest-model"><a class="header" href="#the-nextest-model">The nextest model</a></h2>
<p>cargo-nextest uses a very different execution model, inspired by state-of-the-art test runners used at large corporations. Here's what cargo-nextest does:</p>
<img src="https://user-images.githubusercontent.com/180618/153318044-2a1bb01b-77ff-414b-8ad3-a784934043c4.png"/>
<p>A cargo-nextest run has two separate phases:</p>
<ul>
<li><strong>The list phase.</strong> cargo-nextest first builds all test binaries with <code>cargo test --no-run</code>, then queries those binaries to produce a list of all tests within them.</li>
<li><strong>The run phase.</strong> cargo-nextest then executes each individual test in a separate process, in parallel. It then collects, displays and aggregates results for each individual test.</li>
</ul>
<p>This model solves all the problems of cargo test's execution model, at the cost of a <em>significantly</em> thicker interface to test binaries. <strong>This means that custom test harnesses <a href="book/custom-test-harnesses.html">may need to be adapted</a> to work with cargo-nextest.</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-test-harnesses"><a class="header" href="#custom-test-harnesses">Custom test harnesses</a></h1>
<p>A custom test harness is defined in <code>Cargo.toml</code> as:</p>
<pre><code class="language-toml">[[test]]
name = &quot;my-test&quot;
harness = false
</code></pre>
<p>As mentioned in <a href="book/how-it-works.html">How nextest works</a>, cargo-nextest has a much thicker interface with the test harness than cargo test does. If you don't use any custom harnesses, cargo-nextest will run out of the box. However, users of custom test harnesses may need to be changed to work with cargo nextest. In general, the changes make the test harness look more like the default Rust test harness, and are pretty small overall.</p>
<ul>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>--list --format terse</code>.</strong> This command MUST print to stdout all tests in <em>exactly</em> the format</p>
<pre><code>my-test-1: test
my-test-2: test
</code></pre>
<p>Other output MUST NOT be written to stdout.</p>
<p>Custom test harnesses that are meant to be run as a single unit MUST produce just one line in the output.</p>
</li>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>--list --format terse --ignored</code></strong>. This command MUST print to stdout exactly the set of ignored tests (however the harness defines them) in the same format as above. If there are no ignored tests or if the test harness doesn't support ignored tests, the output MUST be empty.</p>
</li>
<li>
<p><strong>Test names that are not at the top level (however the harness defines this) SHOULD be returned as <code>path::to::test::test_name</code>.</strong> This is recommended because the cargo-nextest UI uses <code>::</code> as a separator to format test names nicely.</p>
</li>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>&lt;test-name&gt; --nocapture --exact</code></strong>. This command will be called with every test name provided by the harness in <code>--list</code> above.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
